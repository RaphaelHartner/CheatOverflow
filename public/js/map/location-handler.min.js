"use strict";!function(){function a(){var a=new XMLHttpRequest;a.open("GET","https://api.stackexchange.com/2.2/sites?key=bF8kysNL8Z2W7K5llHJgGg((",!1),a.onreadystatechange=function(){if(4==a.readyState&&a.status>=200&&a.status<300){for(var c=[],d=JSON.parse(a.responseText).items,e=0;e<d.length;e++)"main_site"==d[e].site_type&&c.push(new b(d[e].name,d[e].api_site_parameter));document.getElementById("stackexSite").innerHTML="",c.forEach(function(a){document.getElementById("stackexSite").innerHTML+='<option value="'+a.apiParam+'">'+a.title+"</option>"})}},a.send()}function b(a,b){this.title=a,this.apiParam=b}function c(){var a=[];null!=localStorage.locations&&(a=JSON.parse(localStorage.locations));var b=$("#locationName").val(),c=$("#fieldName").val(),d=$("#stackexSite option:selected").text(),f=$("#stackexSite").val(),g={locationName:b,fieldName:c,siteName:d,siteParam:f},h="http://nominatim.openstreetmap.org/search?format=json&limit=5&q="+g.locationName;$.getJSON(h,function(c){if(0==c.length)alert("Unable to find requested location '"+b+"'!");else{var d=c[0],f=new OpenLayers.Projection("EPSG:4326"),h=new OpenLayers.Projection("EPSG:900913");d=new OpenLayers.LonLat(d.lon,d.lat).transform(f,h),g.position=d,a.push(g),localStorage.locations=JSON.stringify(a),console.log("Saved location: "+JSON.stringify(g)),e()}})}function d(){var a=localStorage.locations;if(null!=a){var b=$("#locationName").val(),c=f(b);if(null!=c){var d=JSON.parse(localStorage.locations);d.splice(d.indexOf(c),1),localStorage.locations=JSON.stringify(d),e()}}}function e(){var a=localStorage.locations;if(null!=a){var b=JSON.parse(a);$("#locationList").empty(),b.forEach(function(a){var b=document.createElement("LI"),c=document.createTextNode(a.locationName+", "+a.fieldName+", "+a.siteName),d=document.createAttribute("id");d.value=a.locationName;var e=document.createAttribute("class");e.value="location",b.setAttributeNode(e),b.setAttributeNode(d),b.appendChild(c),$("#locationList").append(b)})}}function f(a){var b=localStorage.locations,c=null;if(null==b)return c;var d=JSON.parse(b);return d.forEach(function(b){b.locationName===a&&(c=b)}),c}console.log("initialized address handler"),document.getElementById("stackexSite").innerHTML='<option value="none">Noch nichts geladen...</option>',$("#saveLocation").on("click",c),$("#deleteLocation").on("click",d),a(),e(),$(document).on("click",".location",function(){var a=f(this.id);null!=a&&($("#locationName").val(a.locationName),$("#fieldName").val(a.fieldName))})}();
